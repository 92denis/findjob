<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css" integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ"
        crossorigin="anonymous">
</head>

<body>
    <br>
    <div class="row"></div>
    <div class="col-lg-4">
        <div class="input-group">
            <input type="text" class="form-control" id='search' placeholder="Введите название компании...">
            <span class="input-group-btn">
        <button class="btn btn-secondary btn-success" onclick="searchByName(companies)" type="button">Go!</button>
      </span>
        </div>
    </div>
    <hr>
    <p id="count">
        <p>
            <div id="result"></div>


            <script>
                loadCompanies();
                var div = document.getElementById('result');


                function loadCompanies() {
                    var xhr = new XMLHttpRequest();
                    xhr.open('GET', 'companies.json', true);

                    xhr.onreadystatechange = function () { // (3)
                        if (xhr.readyState != 4) {
                            return;
                        }


                        if (xhr.status != 200) {
                            alert(xhr.status + ': ' + xhr.statusText);
                        } else {

                            companies = JSON.parse(xhr.responseText);
                            showCompany(companies);
                        }
                    }
                    xhr.send(); // (1)


                }

                function showCompany(companies) {
                    companies.forEach(function (company, index) {
                        var newElement = document.createElement('div');
                        var id = 'company' + index;


                        newElement.innerHTML = `<div class="card" id="` + id + `">
                        
                        <div class="card-header">
                            Featured
                        </div>
                        <div class="card-block">
                            <h4 class="card-title">Special title treatment</h4>
                            <p class="card-text"></p>
                            <p class="card-text"></p>
                            <p class="card-text"></p>
                            <p class="card-text"></p>
                            <p class="card-text"></p>
                            <p class="card-text"></p>
                            <button class="btn btn-primary" >Delete</button>
                        </div>
                        </div>`;


                        div.appendChild(newElement);
                        var doc = document.getElementById(id);
                        
                        doc.getElementsByClassName('card-header')[0].innerText = company.Title;
                        doc.getElementsByTagName('h4')[0].innerHTML = company.Name;
                        doc.getElementsByTagName('p')[0].innerText = "Направления: " + company.Tags;
                        doc.getElementsByTagName('p')[1].innerHTML = "Email: " + '<a href="' + company.Email + '">' + company.Email.substring(7) + ' </a>';
                        doc.getElementsByTagName('p')[2].innerText = "Телефон: " + company.Phone;
                        doc.getElementsByTagName('p')[3].innerHTML = 'Сайт: ' + '<a href="' + company.Url + '">' + company.Url + ' </a>';
                        doc.getElementsByTagName('p')[4].innerHTML = "Ссылка dev.by: " + '<a href="' + company.DevByUrl + '">' + company.DevByUrl + ' </a>';
                        doc.getElementsByTagName('p')[5].innerText = "Адрес: " + company.Offices;
                        doc.getElementsByClassName('btn')[0].onclick = deleteCompany;
                    });
                }

                function deleteCompany(elem) {
                    var card = elem.currentTarget.parentNode.parentNode;
                    card.parentNode.removeChild(card);
                    // if (div.childNodes == 0) {
                    //     button.innerHTML = '<button onclick="loadCompanies()" id="button">Load Companies</button>';
                    // }
                    // else {
                    //     button.innerHTML = 'Готово!';
                    // }
                }
                function searchByName(companies) {
                    var countCompanies = document.getElementById("count");
                    var searchString = document.getElementById("search").value;
                    var myExp = new RegExp(searchString, "i");
                    countCompanies.innerHTML = "Найдено компаний: " + companies.length + "/" + companies.length;
                    var count = 0;
                    div.innerHTML = "";
                     
                    companies.forEach(function (company, index) {
                      

                      if ((company.Name.search(myExp) != -1) || (company.Title.search(myExp) != -1)) {
                            console.log(company.Name);
                            var id = 'company' + index;
                            var showSearch = document.createElement('div');

                            showSearch.innerHTML = ` 
                                            <ul class="list-group" id="` + id + `">
                            <li class="list-group-item active">Cras justo odio</li>
                            <li class="list-group-item">Dapibus ac facilisis in</li>
                            <li class="list-group-item">Morbi leo risus</li>
                            <li class="list-group-item">Porta ac consectetur ac</li>
                            <li class="list-group-item">Vestibulum at eros</li>
                            <li class="list-group-item">Porta ac consectetur ac</li>
                            <li class="list-group-item">Vestibulum at eros</li>
                            <li class="list-group-item">Vestibulum at eros</li>
                            </ul>`;
                            div.appendChild(showSearch);
                            var ul = document.getElementById(id);
                            ul.getElementsByTagName('li')[0].innerHTML = company.Title;
                            ul.getElementsByTagName('li')[1].innerHTML = company.Name;
                            ul.getElementsByTagName('li')[2].innerHTML = "Направления: " + company.Tags;
                            ul.getElementsByTagName('li')[3].innerHTML = "Email: " + '<a href="' + company.Email + '">' + company.Email.substring(7) + ' </a>';
                            ul.getElementsByTagName('li')[4].innerHTML = "Телефон: " + company.Phone;
                            ul.getElementsByTagName('li')[5].innerHTML = 'Сайт: ' + '<a href="' + company.Url + '">' + company.Url + ' </a>';
                            ul.getElementsByTagName('li')[6].innerHTML = "Ссылка dev.by: " + '<a href="' + company.DevByUrl + '">' + company.DevByUrl + ' </a>';
                            ul.getElementsByTagName('li')[7].innerHTML = "Адрес: " + company.Offices;
                            count++;
                        }
                       
                        countCompanies.innerHTML = "Найдено компаний: " + count + "/" + companies.length;
                    });
                }
            </script>
</body>

</html>