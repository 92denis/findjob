<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css" integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ"
        crossorigin="anonymous">
</head>

<body>
    <p>Введите название компании: <input type="text" id='search'>
        <button onclick="searchByName(companies)">Поиск</button>
    </p>
    <div id="result"></div>

  
    <script>
          loadCompanies();
        var div = document.getElementById('result');


        function loadCompanies() {
            var xhr = new XMLHttpRequest();
            xhr.open('GET', 'companies.json', true);

            xhr.onreadystatechange = function () { // (3)
                if (xhr.readyState != 4) {
                    return;
                }
             

                if (xhr.status != 200) {
                    alert(xhr.status + ': ' + xhr.statusText);
                } else {

                    companies = JSON.parse(xhr.responseText);
                    showCompany(companies);
                }
            }
            xhr.send(); // (1)
          

        }

        function showCompany(companies) {
            companies.forEach(function (company, index) {
                var newElement = document.createElement('div');
                var id = 'company' + index;


                newElement.innerHTML = `<div class="card" id="` + id + `">
                        
                        <div class="card-header">
                            Featured
                        </div>
                        <div class="card-block">
                            <h4 class="card-title">Special title treatment</h4>
                            <p class="card-text"></p>
                            <p class="card-text"></p>
                            <p class="card-text"></p>
                            <p class="card-text"></p>
                            <p class="card-text"></p>
                            <p class="card-text"></p>
                            <button class="btn btn-primary" >Delete</button>
                        </div>
                        </div>`;


                div.appendChild(newElement);
                var doc = document.getElementById(id);
                doc.getElementsByClassName('card-header')[0].innerText = company.Title;
                doc.getElementsByTagName('h4')[0].innerHTML = company.Name;
                doc.getElementsByTagName('p')[0].innerText = "Напрвления: " + company.Tags;
                doc.getElementsByTagName('p')[1].innerText = "Email: " + company.Email;
                doc.getElementsByTagName('p')[2].innerText = "Телефон: " + company.Phone;
                doc.getElementsByTagName('p')[3].innerText = "Сайт: " + company.Url;
                doc.getElementsByTagName('p')[4].innerText = "Ссылка dev.by: " + company.DevByUrl;
                doc.getElementsByTagName('p')[5].innerText = "Адрес: " + company.Offices;
                doc.getElementsByClassName('btn')[0].onclick = deleteCompany;
            });
        }

        function deleteCompany(elem) {
            var card = elem.currentTarget.parentNode.parentNode;
            card.parentNode.removeChild(card);
            // if (div.childNodes == 0) {
            //     button.innerHTML = '<button onclick="loadCompanies()" id="button">Load Companies</button>';
            // }
            // else {
            //     button.innerHTML = 'Готово!';
            // }
        }
        function searchByName(companies) {
            var searchString = document.getElementById("search").value;
            var myExp = new RegExp(searchString, "i");
            companies.forEach(function (company, index) {
                if((company.Name.search(myExp) != -1) ||((company.Title.search(myExp) != -1))){
                    console.log(company.Name);                                       
                }
            });
        }
    </script>
</body>

</html>